#!/usr/bin/env bash
# SPDX-FileCopyrightText: 2025 Aaron White <w531t4@gmail.com>
# SPDX-License-Identifier: MIT
set -euo pipefail

: "${ESPHOME_HOME_GIT_URL:=}"
dest="/home/vscode/private_config"

if [[ -z "${ESPHOME_HOME_GIT_URL}" ]]; then
    echo "No private repo configured (ESPHOME_HOME_GIT_URL not set). Skipping."
    exit 0
fi

if [[ -d "${dest}/.git" ]]; then
    echo "Updating private repo in ${dest}..."
    git -C "${dest}" fetch --all --prune
    git -C "${dest}" pull --ff-only
else
    echo "Cloning private repo into ${dest}..."
    git clone --depth=1 "${ESPHOME_HOME_GIT_URL}" "${dest}"
fi

ln -snf ${dest} ./config
